<form #form="ngForm" (ngSubmit)="onCreateUser(form)" autocomplete="off" novalidate>
    <div pFocusTrap class="create-user-card">
        <h2 class="create-user-title">{{ title }}</h2>

        <!-- Global error from store -->
        <p *ngIf="error$ | async as err" class="error-message" style="margin-bottom: 0.5rem">
            {{ err }}
        </p>

        <!-- Username Field -->
        <div class="field">
            <label for="username" class="label-with-icon">
                <i class="pi pi-id-card"></i>
                {{ usernameLabel }}
            </label>
            <input
                id="username"
                name="username"
                type="text"
                pInputText
                required
                [(ngModel)]="username"
                [placeholder]="usernamePlaceHolder"
                pAutoFocus
                class="full-width"
                #usernameRef="ngModel"
                autocomplete="off"
            />
            <div *ngIf="usernameRef.invalid && usernameRef.touched" class="error-message">
                <small *ngIf="usernameRef.errors?.['required']">{{ usernameRequiredMSG }}</small>
            </div>
        </div>

        <!-- Email Field -->
        <div class="field">
            <label for="email" class="label-with-icon">
                <i class="pi pi-envelope"></i>
                {{ emailLabel }}
            </label>
            <input
                id="email"
                name="email"
                type="email"
                pInputText
                required
                email
                [(ngModel)]="email"
                [placeholder]="emailPlaceholder"
                class="full-width"
                #emailRef="ngModel"
                autocomplete="off"
            />
            <div *ngIf="emailRef.invalid && emailRef.touched" class="error-message">
                <small *ngIf="emailRef.errors?.['required']">{{ emailRequiredMsg }}</small>
                <small *ngIf="emailRef.errors?.['email']">{{ emailInvalidMsg }}</small>
            </div>
        </div>

        <!-- Password Field  -->
        <div class="field">
            <label for="password" class="label-with-icon">
                <i class="pi pi-lock"></i>
                {{ passwordLabel }}
            </label>
            <p-password
                inputId="password"
                name="password"
                required
                [minlength]="passwordMinLength"
                [(ngModel)]="password"
                [placeholder]="passwordPlaceholder"
                [feedback]="false"
                [toggleMask]="true"
                styleClass="full-width"
                #passwordRef="ngModel"
            ></p-password>
            <div *ngIf="passwordRef.invalid && passwordRef.touched" class="error-message">
                <small *ngIf="passwordRef.errors?.['required']">{{ passwordRequiredMsg }}</small>
                <small *ngIf="passwordRef.errors?.['minlength']">{{ passwordMinLengthMsg }}</small>
            </div>
        </div>

        <!-- Submit Button -->
        <p-button
            class="create-user-button"
            [label]="buttonLabel"
            icon="pi pi-user-plus"
            type="submit"
            [loading]="(loading$ | async) ?? false"
            [disabled]="form.invalid || ((loading$ | async) ?? false)"
        ></p-button>
    </div>
</form>
